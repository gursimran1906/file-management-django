{% extends 'base.html' %} {% load utils %} {% block title %}Holiday Records{% endblock %} {% block container %}

<div class="grid md:grid-cols-3 gap-4 mt-2">
  <h1 class="div-container md:w-fit h-fit text-3xl font-medium">
    All Holiday Records
  </h1>
  <div class="div-container">
    <table class="table">
      <thead>
        <tr>
          <th colspan="2" class="text-lg text-black font-normal text-center">
            Selected Rows Totals
          </th>
        </tr>
      </thead>
      <tbody>
        <tr class="border-b text-black">
          <th class="td" scope="row">Total Annual Leave:</th>
          <td class="td"><span id="totalAnnualLeave">0.00</span></td>
        </tr>
        <tr class="border-b text-black">
          <th class="td" scope="row">Total Unpaid Leave:</th>
          <td class="td"><span id="totalUnpaidLeave">0.00</span></td>
        </tr>
      </tbody>
    </table>
  </div>
  <div class="div-container md:justify-self-end">
    <form method="POST" action="{% url 'holiday_record_csv'%}">
      {% csrf_token %}
      <h3 class="text-2xl mb-4 text-center">Actions</h3>
      <div class="flex flex-col gap-4">
        <div
          date-rangepicker
          datepicker-buttons
          datepicker-autoselect-today
          datepicker-format="dd/mm/yyyy"
          datepicker-title="Choose date range"
          class="flex items-center"
        >
          <div class="relative">
            <div
              class="absolute inset-y-0 start-0 flex items-center ps-2 pointer-events-none"
            >
              <svg
                class="w-4 h-4 text-gray-500 dark:text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"
                />
              </svg>
            </div>
            <input
              name="start_date"
              type="text"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
              placeholder="Select date start"
            />
          </div>
          <span class="mx-4 text-gray-500">to</span>
          <div class="relative">
            <div
              class="absolute inset-y-0 start-0 flex items-center ps-2 pointer-events-none"
            >
              <svg
                class="w-4 h-4 text-gray-500 dark:text-gray-400"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  d="M20 4a2 2 0 0 0-2-2h-2V1a1 1 0 0 0-2 0v1h-3V1a1 1 0 0 0-2 0v1H6V1a1 1 0 0 0-2 0v1H2a2 2 0 0 0-2 2v2h20V4ZM0 18a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V8H0v10Zm5-8h10a1 1 0 0 1 0 2H5a1 1 0 0 1 0-2Z"
                />
              </svg>
            </div>
            <input
              name="end_date"
              type="text"
              class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full ps-10 p-2.5 dark:bg-gray-700 dark:border-gray-600 dark:placeholder-gray-400 dark:text-white dark:focus:ring-blue-500 dark:focus:border-blue-500"
              placeholder="Select date end"
            />
          </div>
        </div>
        <button class="btn-primary" type="submit">
          Download Records as CSV
        </button>
      </div>
    </form>
  </div>
</div>

<!-- Holidays Summary Section -->
<div class="div-container mt-4">
  <div class="flex flex-col gap-4">
    <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4">
      <h2 class="text-xl font-semibold text-gray-700">Holidays Summary</h2>
      <div class="flex flex-col md:flex-row gap-2">
        <select id="holidays-summary-user-select-records" class="form-input">
          <option value="">Select User</option>
          {% for user in users %}
          <option value="{{ user.id }}">{{ user.username }}</option>
          {% endfor %}
        </select>
        <select id="holidays-summary-year-select-records" class="form-input">
          <!-- Options will be populated by JavaScript -->
        </select>
      </div>
    </div>
    
    <div id="holidays-summary-container-records" class="grid md:grid-cols-2 gap-4">
      <!-- Paid Holidays Summary -->
      <div class="div-container">
        <table class="table">
          <thead>
            <tr>
              <th colspan="2" class="text-lg px-2 pb-2 text-gray-900 text-center font-normal">
                Paid Holidays Summary
                <span class="text-xs font-light" id="holidays-summary-year-text-records">for current year</span>
              </th>
            </tr>
          </thead>
          <tbody>
            <tr class="border-b">
              <th class="py-2 px-2 font-normal text-gray-800">Allowance</th>
              <td class="py-2 px-2 font-light text-gray-700" id="holidays-allowance-records">-</td>
            </tr>
            <tr class="border-b bg-gray-50">
              <th class="py-2 px-2 font-normal text-gray-800">Taken</th>
              <td class="py-2 px-2 font-light text-gray-700" id="holidays-taken-records">-</td>
            </tr>
            <tr class="border-b">
              <th class="py-2 px-2 font-normal text-gray-800">Office Closure</th>
              <td class="py-2 px-2 font-light text-gray-700" id="holidays-office-closure-records">-</td>
            </tr>
            <tr class="border-b">
              <th class="py-2 px-2 font-normal text-gray-800">Bank Holidays</th>
              <td class="py-2 px-2 font-light text-gray-700" id="holidays-bank-holidays-records">-</td>
            </tr>
            <tr class="border-b bg-gray-50">
              <th class="py-2 px-2 font-normal text-gray-800 flex flex-row items-center gap-2">
                Remaining
                <a data-popover-target="holidays_remaining_summary_records">
                  <svg class="w-4 h-4 text-gray-800 dark:text-white" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                    <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M10 11h2v5m-2 0h4m-2.592-8.5h.01M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
                  </svg>
                </a>
              </th>
              <td class="py-2 px-2 text-gray-800" id="holidays-remaining-records">-</td>
              <div id="holidays_remaining_summary_records" role="tooltip" class="absolute z-50 invisible inline-block w-72 text-sm transition-opacity duration-300 border rounded-lg shadow-sm opacity-0 text-gray-200 border-gray-600 bg-gray-800">
                <div class="px-3 py-2 border-b rounded-t-lg border-gray-600 bg-gray-700 flex items-center">
                  <h3 class="font-medium text-white">Paid Holidays Remaining</h3>
                </div>
                <div class="px-3 py-2 font-light text-gray-200">
                  <p>
                    <b class="text-gray-50">Paid Holidays Remaining</b> are calculated by taking the 
                    <b class="text-gray-50">Total Paid Holidays Allowance</b> for the year, subtracting the 
                    <b class="text-gray-50">Total Paid Holidays Taken</b>, and further subtracting both 
                    <b class="text-gray-50">Bank Holidays</b> and <b class="text-gray-50">Office Closure Holidays.</b>
                  </p>
                </div>
                <div data-popper-arrow></div>
              </div>
            </tr>
          </tbody>
        </table>
      </div>
      
      <!-- Unpaid Holidays Summary -->
      <div class="div-container h-fit">
        <table class="table">
          <tbody>
            <tr class="border-b">
              <th colspan="2" class="text-lg px-2 pb-2 text-gray-900 text-center font-normal">
                Unpaid Holidays
                <span class="text-xs font-light" id="holidays-unpaid-year-text-records">for current year</span>
              </th>
            </tr>
            <tr class="border-b bg-gray-50">
              <th class="py-2 px-2 font-normal text-gray-800">Taken</th>
              <td class="py-2 px-2 text-gray-700" id="holidays-unpaid-records">-</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
    
    <!-- Days Accounting Summary -->
    <div class="div-container">
      <h3 class="text-lg font-semibold text-gray-700 mb-3">Days Accounting Summary</h3>
      <div class="grid md:grid-cols-2 gap-4 mb-4">
        <div class="div-container">
          <table class="table">
            <thead>
              <tr>
                <th colspan="2" class="text-lg px-2 pb-2 text-gray-900 text-center font-normal">
                  Days Breakdown
                </th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b">
                <th class="py-2 px-2 font-normal text-gray-800">Total Working Days</th>
                <td class="py-2 px-2 font-light text-gray-700" id="total-working-days-records">-</td>
              </tr>
              <tr class="border-b bg-gray-50">
                <th class="py-2 px-2 font-normal text-gray-800">Days with Attendance</th>
                <td class="py-2 px-2 font-light text-gray-700" id="days-with-attendance-records">-</td>
              </tr>
              <tr class="border-b">
                <th class="py-2 px-2 font-normal text-gray-800">Total Accounted Days</th>
                <td class="py-2 px-2 font-light text-gray-700" id="total-accounted-days-records">-</td>
              </tr>
              <tr class="border-b bg-gray-50">
                <th class="py-2 px-2 font-normal text-gray-800">Unaccounted Days</th>
                <td class="py-2 px-2 font-light text-gray-700" id="unaccounted-days-records">-</td>
              </tr>
            </tbody>
          </table>
        </div>
        <div class="div-container">
          <table class="table">
            <thead>
              <tr>
                <th colspan="2" class="text-lg px-2 pb-2 text-gray-900 text-center font-normal">
                  Accounted Days Breakdown
                </th>
              </tr>
            </thead>
            <tbody>
              <tr class="border-b">
                <th class="py-2 px-2 font-normal text-gray-800">Paid Holidays</th>
                <td class="py-2 px-2 font-light text-gray-700" id="accounted-paid-holidays-records">-</td>
              </tr>
              <tr class="border-b bg-gray-50">
                <th class="py-2 px-2 font-normal text-gray-800">Unpaid Holidays</th>
                <td class="py-2 px-2 font-light text-gray-700" id="accounted-unpaid-holidays-records">-</td>
              </tr>
              <tr class="border-b">
                <th class="py-2 px-2 font-normal text-gray-800">Sick Leave</th>
                <td class="py-2 px-2 font-light text-gray-700" id="accounted-sick-leave-records">-</td>
              </tr>
              <tr class="border-b bg-gray-50">
                <th class="py-2 px-2 font-normal text-gray-800">Bank Holidays</th>
                <td class="py-2 px-2 font-light text-gray-700" id="accounted-bank-holidays-records">-</td>
              </tr>
              <tr class="border-b">
                <th class="py-2 px-2 font-normal text-gray-800">Office Closures</th>
                <td class="py-2 px-2 font-light text-gray-700" id="accounted-office-closures-records">-</td>
              </tr>
              <tr class="border-b bg-gray-50">
                <th class="py-2 px-2 font-normal text-gray-800">Days with Attendance</th>
                <td class="py-2 px-2 font-light text-gray-700" id="accounted-attendance-days-records">-</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="text-sm text-gray-600 space-y-2" id="holidays-calculation-breakdown-records">
        <p>Select a user and year to see the calculation breakdown.</p>
      </div>
    </div>
  </div>
</div>

<div class="overflow-auto div-container mt-4">
  <table id="holidayTable" class="min-w-full text-sm text-gray-800">
    <thead>
      <tr>
        <th class="text-left py-2 px-4 border-b border-gray-200">Employee</th>
        <th class="text-left py-2 px-4 border-b border-gray-200">Type</th>
        <th class="text-left py-2 px-4 border-b border-gray-200">Days</th>
        <th class="text-left py-2 px-4 border-b border-gray-200">Start Date</th>
        <th class="text-left py-2 px-4 border-b border-gray-200">End Date</th>
        <th class="text-left py-2 px-4 border-b border-gray-200">Status</th>
        <th class="text-left py-2 px-4 border-b border-gray-200">Reason</th>
        <th class="text-left py-2 px-4 border-b border-gray-200">Action</th>
      </tr>
    </thead>
    <tbody>
      {% for holiday in holiday_records %}
      <tr class="hover:bg-gray-50 cursor-pointer">
        <td class="py-2 px-4 border-b border-gray-200">
          {{ holiday.request.employee }}
        </td>
        <td class="py-2 px-4 border-b border-gray-200">
          {{ holiday.request.type }}
        </td>
        <td class="py-2 px-4 border-b border-gray-200">
          {{ holiday.total_days }}
        </td>
        <td class="py-2 px-4 border-b border-gray-200">
          {{ holiday.request.start_date|date:"d/m/Y H:i" }}
        </td>
        <td class="py-2 px-4 border-b border-gray-200">
          {{ holiday.request.end_date|date:"d/m/Y H:i" }}
        </td>
        <td class="py-2 px-4 border-b border-gray-200">
          {% if holiday.request.approved %}
          <span class="badge-green">Approved</span>
          {% elif holiday.request.checked_by %}
          <span class="badge-red">Rejected</span>
          {% else %}
          <span class="badge-purple">Pending</span>
          {% endif %}
        </td>
        <td class="py-2 px-4 border-b border-gray-200">
          {{ holiday.request.reason }}
        </td>
        <td class="py-2 px-4 border-b border-gray-200">
          <a
            class="link"
            href="{% url 'edit_holiday_record' holiday.request.id %}"
            >Edit</a
          >
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6" class="py-4 text-center text-gray-500">
          No holiday records found.
        </td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot>
      <tr>
        <th class="text-left py-2 px-4">Employee</th>
        <th class="text-left py-2 px-4">Type</th>
        <th class="text-left py-2 px-4">Days</th>
        <th class="text-left py-2 px-4">Start Date</th>
        <th class="text-left py-2 px-4">End Date</th>
        <th class="text-left py-2 px-4">Status</th>
        <th class="text-left py-2 px-4">Reason</th>
        <th class="text-left py-2 px-4">Action</th>
      </tr>
    </tfoot>
  </table>
</div>

<script>
  $(document).ready(function () {
    $.fn.dataTable.moment('DD/MM/YYYY HH:mm');

    var table = $("#holidayTable").DataTable({
      ordering: true,
      responsive: true,
      lengthMenu: [
        [10, 25, 50, -1],
        [10, 25, 50, "All"],
      ],
      pageLength: 10,
    });

    function updateTotals() {
      var selectedRows = table.rows(".selected").data();
      var totalAnnualLeave = 0;
      var totalUnpaidLeave = 0;

      for (var i = 0; i < selectedRows.length; i++) {
        var leaveType = selectedRows[i][1];
        var leaveDays = parseFloat(selectedRows[i][2]);
        if (leaveType === "Paid") {
          totalAnnualLeave += leaveDays;
        } else if (leaveType === "Unpaid") {
          totalUnpaidLeave += leaveDays;
        }
      }

      $("#totalAnnualLeave").text(totalAnnualLeave.toFixed(2));
      $("#totalUnpaidLeave").text(totalUnpaidLeave.toFixed(2));
    }

    $("#holidayTable tbody").on("click", "tr", function () {
      $(this).toggleClass("selected bg-slate-50");
      updateTotals();
    });

    table.on("draw", function () {
      var visibleRows = table.rows({ page: "current" }).indexes();

      table.rows().every(function (rowIdx) {
        var rowNode = this.node();
        var isVisible = visibleRows.indexOf(rowIdx) !== -1;
        $(rowNode).toggleClass("selected bg-slate-50", isVisible);
      });
      updateTotals();
    });

    table.on("draw", function () {
      // var visibleRows = table.rows({
      //     search: 'applied'
      // }).indexes();

      var visibleRows = table
        .rows({
          page: "current",
        })
        .indexes();

      table.rows().every(function (rowIdx) {
        var rowNode = this.node();
        var isVisible = visibleRows.indexOf(rowIdx) !== -1;
        if (isVisible) {
          $(rowNode).addClass("selected bg-slate-50");
        } else {
          $(rowNode).removeClass("selected bg-slate-50");
        }
      });
      updateTotals();
    });

    $("#holidayTable tfoot th").each(function () {
      var title = $(this).text();
      $(this).html(
        '<input class="w-full px-2 py-2 rounded-lg border border-gray-100 focus:ring-1 focus:ring-inset focus:ring-gray-600 placeholder:italic placeholder:text-gray-400 placeholder:font-light text-light" type="text" placeholder="Search ' +
          title +
          '" />'
      );
    });

    table.columns().every(function () {
      var that = this;
      $("input", this.footer()).on("keyup change", function () {
        if (that.search() !== this.value) {
          that.search(this.value).draw();
        }
      });
    });

    $("#holidayTable th").hover(
      function () {
        $(this).css("cursor", "pointer");
      },
      function () {
        $(this).css("cursor", "auto");
      }
    );

    table.on("order.dt", function () {
      $("#holidayTable thead th").each(function () {
        $(this).removeClass("asc desc");
      });

      var order = table.order();
      if (order.length) {
        var th = $("#holidayTable thead th:eq(" + order[0][0] + ")");
        th.addClass(order[0][1]);
      }
    });
  });
</script>

<script>
  // Holidays Summary Functionality for Holiday Records Page
  document.addEventListener("DOMContentLoaded", function () {
    const userSelect = document.getElementById("holidays-summary-user-select-records");
    const yearSelect = document.getElementById("holidays-summary-year-select-records");
    
    // Populate year dropdown
    const currentYear = new Date().getFullYear();
    for (let year = currentYear - 5; year <= currentYear + 5; year++) {
      const option = document.createElement("option");
      option.value = year;
      option.textContent = year;
      if (year === currentYear) {
        option.selected = true;
      }
      yearSelect.appendChild(option);
    }
    
    function fetchHolidaysSummary() {
      const userId = userSelect.value;
      const year = yearSelect.value;
      
      if (!userId) {
        // Clear the display
        document.getElementById("holidays-allowance-records").textContent = "-";
        document.getElementById("holidays-taken-records").textContent = "-";
        document.getElementById("holidays-office-closure-records").textContent = "-";
        document.getElementById("holidays-bank-holidays-records").textContent = "-";
        document.getElementById("holidays-remaining-records").textContent = "-";
        document.getElementById("holidays-unpaid-records").textContent = "-";
        document.getElementById("total-working-days-records").textContent = "-";
        document.getElementById("days-with-attendance-records").textContent = "-";
        document.getElementById("total-accounted-days-records").textContent = "-";
        document.getElementById("unaccounted-days-records").textContent = "-";
        document.getElementById("accounted-paid-holidays-records").textContent = "-";
        document.getElementById("accounted-unpaid-holidays-records").textContent = "-";
        document.getElementById("accounted-sick-leave-records").textContent = "-";
        document.getElementById("accounted-bank-holidays-records").textContent = "-";
        document.getElementById("accounted-office-closures-records").textContent = "-";
        document.getElementById("accounted-attendance-days-records").textContent = "-";
        document.getElementById("holidays-calculation-breakdown-records").innerHTML = "<p class='text-gray-500'>Select a user and year to see the calculation breakdown.</p>";
        return;
      }
      
      fetch(`/holidays-summary/?user_id=${userId}&year=${year}`)
        .then(response => response.json())
        .then(data => {
          if (data.error) {
            console.error(data.error);
            return;
          }
          
          // Update the display
          document.getElementById("holidays-allowance-records").textContent = data.allowance.toFixed(2);
          document.getElementById("holidays-taken-records").textContent = data.total_paid_holidays.toFixed(2);
          // Use full year office closures for Holidays Summary display
          document.getElementById("holidays-office-closure-records").textContent = (data.total_office_closure_holidays_full_year || data.total_office_closure_holidays).toFixed(2);
          document.getElementById("holidays-bank-holidays-records").textContent = data.total_bank_holidays.toFixed(2);
          document.getElementById("holidays-remaining-records").textContent = data.total_paid_holidays_remaining.toFixed(2);
          document.getElementById("holidays-unpaid-records").textContent = data.total_unpaid_holidays.toFixed(2);
          
          // Update year text
          document.getElementById("holidays-summary-year-text-records").textContent = `for ${year}`;
          document.getElementById("holidays-unpaid-year-text-records").textContent = `for ${year}`;
          
          // Update days accounting summary
          document.getElementById("total-working-days-records").textContent = data.total_working_days.toFixed(2);
          document.getElementById("days-with-attendance-records").textContent = (data.days_with_attendance || 0).toFixed(2);
          document.getElementById("total-accounted-days-records").textContent = data.total_accounted_days.toFixed(2);
          const unaccountedDays = data.unaccounted_days;
          const unaccountedCell = document.getElementById("unaccounted-days-records");
          unaccountedCell.textContent = unaccountedDays.toFixed(2);
          if (unaccountedDays > 0) {
            unaccountedCell.classList.add("text-red-600", "font-semibold");
            unaccountedCell.classList.remove("text-gray-700");
          } else {
            unaccountedCell.classList.remove("text-red-600", "font-semibold");
            unaccountedCell.classList.add("text-gray-700");
          }
          
          // Update accounted days breakdown
          document.getElementById("accounted-paid-holidays-records").textContent = data.total_paid_holidays.toFixed(2);
          document.getElementById("accounted-unpaid-holidays-records").textContent = data.total_unpaid_holidays.toFixed(2);
          document.getElementById("accounted-sick-leave-records").textContent = (data.total_sick_leave || 0).toFixed(2);
          document.getElementById("accounted-bank-holidays-records").textContent = data.total_bank_holidays.toFixed(2);
          document.getElementById("accounted-office-closures-records").textContent = data.total_office_closure_holidays.toFixed(2);
          document.getElementById("accounted-attendance-days-records").textContent = (data.days_with_attendance || 0).toFixed(2);
          
          // Update calculation breakdown
          const breakdown = `
            <div class="space-y-1">
              <p><b class="text-gray-800">Remaining Calculation:</b></p>
              <p class="ml-4">Allowance (${data.allowance.toFixed(2)}) - Taken (${data.total_paid_holidays.toFixed(2)}) - Bank Holidays (${data.total_bank_holidays.toFixed(2)}) - Office Closure (${data.total_office_closure_holidays.toFixed(2)}) = <b class="text-gray-800">${data.total_paid_holidays_remaining.toFixed(2)}</b></p>
              <p class="mt-2"><b class="text-gray-800">Days Accounting:</b></p>
              <p class="ml-4">Total Working Days (${data.total_working_days.toFixed(2)}) ${data.date_range_description ? `<span class="text-xs text-gray-500">${data.date_range_description}</span>` : ''} - Total Accounted Days (${data.total_accounted_days.toFixed(2)}) = <b class="text-gray-800 ${unaccountedDays > 0 ? 'text-red-600' : ''}">${unaccountedDays.toFixed(2)} Unaccounted Days</b></p>
              <p class="ml-4 text-xs text-gray-500">Accounted Days = Paid Holidays + Unpaid Holidays + Sick Leave + Bank Holidays + Office Closures + Days with Attendance</p>
              <p class="ml-4 text-xs text-gray-500">Days with Attendance = Days where employee has clocked in (worked days)</p>
              ${data.is_current_year || data.is_future_year ? `<p class="ml-4 text-xs text-blue-600 font-semibold">ℹ️ Note: Calculations are based on dates up to today (${new Date().toLocaleDateString('en-GB')}). Future dates are excluded.</p>` : ''}
              ${unaccountedDays > 0 ? `<p class="mt-2 text-red-600 font-semibold">⚠️ Warning: There are ${unaccountedDays.toFixed(2)} unaccounted working days. These may need to be reviewed.</p>` : ''}
              <p class="mt-2"><b class="text-gray-800">Note:</b> Office Closure days are excluded from the "Taken" count.</p>
            </div>
          `;
          document.getElementById("holidays-calculation-breakdown-records").innerHTML = breakdown;
        })
        .catch(error => {
          console.error("Error fetching holidays summary:", error);
        });
    }
    
    userSelect.addEventListener("change", fetchHolidaysSummary);
    yearSelect.addEventListener("change", fetchHolidaysSummary);
  });
</script>
{% endblock %}
