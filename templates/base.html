<!--base.html-->
{% load static %}
{% load compress %} 

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}Your Page Title{% endblock %}</title>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.datatables.net/1.10.24/js/jquery.dataTables.min.js"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
    <script src="https://cdn.datatables.net/plug-ins/1.10.19/sorting/datetime-moment.js"></script>
    <link rel="icon" type="image/png" href="{% static 'images/logo.png' %}">
    <script src="{% static 'js/functions.js' %}"></script>
    
    {% compress css %}
      <link rel="stylesheet" href="{% static 'src/output.css' %}">
    {% endcompress %}
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/datepicker.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>
    <script>
      function toggleNormalCollapse(id) {
        const element = $('#' + id);
        if (element.hasClass('hidden')) {
          element.hide().removeClass('hidden').slideDown();
        } else {
          element.slideUp(() => element.addClass('hidden'));
        }
      }
  
      function toggleCollapse(id) {
        const element = $('#' + id);
        const parentElement = element.parent();
        const grandParentElement = parentElement.parent();
  
        if (element.hasClass('h-0')) {
          element.hide().removeClass('h-0').addClass('h-full').slideDown();
          parentElement.addClass('mb-4');
          grandParentElement.addClass('h-full');
        } else {
          element.slideUp(() => {
            element.addClass('h-0').removeClass('h-full');
            parentElement.removeClass('mb-4');
            grandParentElement.removeClass('h-full');
          });
        }
      }
    </script>
    {% include 'django_quill/media.html' %}
    <style>
      
      .dataTables_filter {
        font-size:12px;
        float: right;
        display: inline;
        margin-bottom: 8px;
        position: sticky;
      }
      
      .dataTables_length {
        font-size:12px;
        display: inline;
        margin-bottom: 8px;
        position: sticky;
        left:0;
      }
      
      .dataTables_filter label,
      .dataTables_length label {
        color: #4a5568; /* Gray-700 */
      }
      
      .dataTables_filter input[type="search"],
      .dataTables_length select {
        border: 1px solid #a0aec0; /* Gray-300 */
        border-radius: 0.375rem; /* Rounded-md */
        padding: 0.25rem 0.5rem; /* Adjusted padding */
        outline: none;
      }
      
      .dataTables_filter input[type="search"]:focus,
      .dataTables_length select:focus {
        border-color: #4299e1; /* Blue-500 */
      }
      .dataTables_info,
      .dataTables_paginate {
        
        font-size:12px;
        
        
         /* Center align pagination */
        margin-top: 10px; /* Adjust margin as needed */
      }
      
      .dataTables_paginate a {
        font-size:12px;
        display: inline-block;
        padding: 0.25rem 0.5rem;
        margin-right: 5px;
        border: 1px solid #ccc;
        border-radius: 4px;
        background-color: #f5f5f5;
        color: #333;
        text-decoration: none;
      }
      
      .dataTables_paginate a.current {
        background-color: rgb(37, 99, 235); /* Current page background color */
        color: #fff; /* Current page text color */
      }
      
      .dataTables_paginate a.disabled {
        color: #aaa; /* Disabled page text color */
        pointer-events: none; /* Disable pointer events */
      }
      .dataTable thead th::after {
        content: ' ▲▼';
        color: rgb(209 213 219);
        margin-left: 1px;
      }
      .dataTable thead th.asc::after {
          content: ' ▲';
  
          color: rgb(75 85 99);
          margin-left: 1px;
      }
  
      .dataTable thead th.desc::after {
          content: ' ▼';
  
          color: rgb(75 85 99);
          margin-left: 1px;
      }
    </style>
    <!-- Add your custom styles here if needed -->
    {% block styles %}{% endblock %}
    <script>
      document.addEventListener('DOMContentLoaded', function() {
          var unreadPoliciesExist = {{ unread_policies_exist|lower|safe }};
          
          function getCookie(name) {
              const value = `; ${document.cookie}`;
              const parts = value.split(`; ${name}=`);
              if (parts.length === 2) return parts.pop().split(';').shift();
          }
          
          function setCookie(name, value) {
            const hours = 4;
            const date = new Date();
            date.setTime(date.getTime() + (hours * 60 * 60 * 1000));
            const expires = "; expires=" + date.toUTCString();
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
          }
  
          var policiesAlertDismissed = getCookie('policiesAlertDismissed');
          
          setTimeout(function() {
              if (unreadPoliciesExist && policiesAlertDismissed !== 'true') {
                  $('#alert-policies').removeClass('hidden').addClass('flex').hide().slideDown();
              } else {
                  $('#alert-policies').slideUp(function() {
                      $(this).removeClass('flex').addClass('hidden');
                  });
              }
          }, 400);
  
          // Add event listener to close button
          const closeButton = document.querySelector('[data-dismiss-target="#alert-policies"]');
          if (closeButton) {
              closeButton.addEventListener('click', function() {
                  // Set the cookie to indicate the alert has been dismissed
                  setCookie('policiesAlertDismissed', 'true'); // Session cookie
              });
          }
      });
      document.addEventListener('DOMContentLoaded', () => {
        const navbar = document.querySelector('nav');
        const navbarHeight = navbar.offsetHeight; // Get the navbar height
      
        document.documentElement.style.setProperty('--navbar-height', `${navbarHeight}px`);
      });
    


    </script>
    <script>
      async function handleDownload(event) {
        event.preventDefault(); // Prevent default link behavior
    
        const link = event.target; // Get the clicked link
        const downloadUrl = link.href; // Get the Django-generated URL from the href attribute
    
        // Update link state to "Downloading"
        link.textContent = 'Downloading...';
        link.classList.add('btn-primary');
        link.classList.remove('btn-secondary');
        link.style.pointerEvents = 'none'; // Disable further clicks during download
    
        try {
          // Fetch the file using the Django URL
          const response = await fetch(downloadUrl);
    
          if (!response.ok) {
            throw new Error('Download failed');
          }
    
          const contentDisposition = response.headers.get('Content-Disposition');
          let fileName = 'downloaded_file.csv'; // Default filename
    
          // If Content-Disposition header is present, extract the filename
          if (contentDisposition && contentDisposition.includes('attachment')) {
            const fileNameMatch = contentDisposition.match(/filename="([^"]+)"/);
            if (fileNameMatch && fileNameMatch[1]) {
              fileName = fileNameMatch[1];
            }
          }
    
          // Convert the response to a Blob
          const blob = await response.blob();
    
          // Create a temporary download link
          const blobUrl = URL.createObjectURL(blob);
          const tempLink = document.createElement('a');
          tempLink.href = blobUrl;
          
          // Trigger the download with the extracted filename
          tempLink.download = fileName;
    
          document.body.appendChild(tempLink);
          tempLink.click();
          document.body.removeChild(tempLink);
          URL.revokeObjectURL(blobUrl);
    
          // Update link state to "Downloaded"
          link.textContent = 'Downloaded';
          link.classList.add('downloaded');
        } catch (error) {
          console.error('Download error:', error);
    
          // Update link state to "Error"
          link.textContent = 'Error';
          link.classList.remove('downloading');
          link.classList.add('error');
        } finally {
          // Re-enable the link
          link.style.pointerEvents = 'auto';
        }
      }
    </script>
    
    
    <style>
      :root {
        --navbar-height: 64px; /* Default value for fallback */
      }
      
      #content {
        height: calc(100vh - var(--navbar-height));
      }
      

          /* Body and html for custom scrollbar appearance */
    body, html {
        scrollbar-width: thin; /* Thin scrollbars for Firefox */
        scrollbar-color: transparent transparent; /* Hide scrollbar */
    }

    /* Show scrollbar on scroll (Webkit browsers) */
    .scrolling {
        overflow-y: scroll; /* Always show scrollbar */
        scrollbar-color: rgba(100, 100, 100, 0.5) transparent; /* Custom thumb color */
       
        box-sizing: content-box; /* Ensure padding doesn't affect layout */
    }

    /* Custom scrollbar styles for Webkit browsers */
    .scrolling::-webkit-scrollbar {
        width: 8px; /* Set scrollbar width */
    }

    .scrolling::-webkit-scrollbar-thumb {
        background-color: rgba(100, 100, 100, 0.5); /* Custom thumb color */
        border-radius: 4px; /* Rounded corners for the thumb */
    }

    .scrolling::-webkit-scrollbar-track {
        background-color: transparent; /* Transparent track */
    }

    /* Optional: Hide scrollbar but keep space occupied */
    ::-webkit-scrollbar {
        display: none; /* Hide scrollbar by default */
    }

    /* Show scrollbar when content overflows */
  ::-webkit-scrollbar {
        display: block; /* Show scrollbar when content overflows */
    }

      
    </style>
  </head>

  <body class="container w-full bg-gray-50">
    {% include 'navbar.html' %}
    <div id="content"
        class="sm:ml-64 sm:p-0 mt-[var(--navbar-height)]"
        
      >
    <div class="p-4 sm:w-vw-64 sm" style="height: calc(100vh - var(--navbar-height));">
        {% if unread_policies_exist %}
        <div
            id="alert-policies"
            class="hidden items-center border p-4 mb-2 text-blue-800 rounded-lg bg-blue-50 dark:bg-gray-800 dark:text-blue-400"
            role="alert"
          >
            <svg
                class="flex-shrink-0 w-4 h-4"
                aria-hidden="true"
                xmlns="http://www.w3.org/2000/svg"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                    d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"
                />
            </svg>
            <span class="sr-only">Info</span>
            <div class="ms-3 text-sm font-medium">
                You have unread policies.
                <a
                    href="{% url 'policies_display' %}"
                    class="font-semibold underline hover:no-underline"
                >Click here</a>
                to review and acknowledge them.
            </div>
            <button
                type="button"
                class="ms-auto -mx-1.5 -my-1.5 bg-blue-50 text-blue-500 rounded-lg focus:ring-2 focus:ring-blue-400 p-1.5 hover:bg-blue-200 inline-flex items-center justify-center h-8 w-8 dark:bg-gray-800 dark:text-blue-400 dark:hover:bg-gray-700"
                data-dismiss-target="#alert-policies"
                aria-label="Close"
              >
                <span class="sr-only">Close</span>
                <svg
                    class="w-3 h-3"
                    aria-hidden="true"
                    xmlns="http://www.w3.org/2000/svg"
                    fill="none"
                    viewBox="0 0 14 14"
                >
                    <path
                        stroke="currentColor"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"
                    />
                </svg>
            </button>
        </div>
        {% endif %}

        {% block messages %}
          {% if messages %}
            <div class="messages">
              {% for message in messages %}
                {% if message.tags == 'success' %}
                  <div class="bg-green-50 border text-sm font-medium text-green-800 p-4 mb-2 rounded-lg " role="alert">
                    <div class='flex'>
                      <svg
                      class="flex-shrink-0 w-5 h-5"
                      aria-hidden="true"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="currentColor"
                      viewBox="0 0 23 23"
                      > 
                          <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm13.707-1.293a1 1 0 0 0-1.414-1.414L11 12.586l-1.793-1.793a1 1 0 0 0-1.414 1.414l2.5 2.5a1 1 0 0 0 1.414 0l4-4Z" clip-rule="evenodd"/>
                        </svg>
                      
                      <span class='ms-3'>{{ message }}</span>
                    </div>
                
                  </div>
                {% elif message.tags == 'error' %}
                  <div class="bg-red-50 border text-sm font-medium  text-red-800 p-4 mb-2 rounded-lg " role="alert">
                    <div class="flex">
                      <svg
                        class="flex-shrink-0 w-5 h-5"
                        aria-hidden="true"
                        xmlns="http://www.w3.org/2000/svg"
                        fill="currentColor"
                        viewBox="0 0 23 23"
                        > 
                      <path fill-rule="evenodd" d="M2 12C2 6.477 6.477 2 12 2s10 4.477 10 10-4.477 10-10 10S2 17.523 2 12Zm11-4a1 1 0 1 0-2 0v5a1 1 0 1 0 2 0V8Zm-1 7a1 1 0 1 0 0 2h.01a1 1 0 1 0 0-2H12Z" clip-rule="evenodd"/>
                        
                      </svg>
                      <span class='ms-3'>{{ message }}</span>
                    </div>
                    
                  </div>
                {% else %}
                  <!-- Handle other message levels if needed -->
                  <div class="bg-blue-50 border text-sm font-medium text-blue-800 p-4 mb-2 rounded-lg " role="alert">
                    <div class="flex">
                      <svg class="flex-shrink-0 w-5 h-5" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                      </svg>
                      <span class='ms-3'>{{ message }}</span>
                    </div>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
        {% endblock %}

        
        {% block container %}{% endblock %}
      </div>
    </div>
    
    <script>
    // Function to add 'scrolling' class to the element being scrolled
    function handleScroll(event) {
      // Remove the 'scrolling' class from all elements
      document.querySelectorAll('.scrolling').forEach(el => el.classList.remove('scrolling'));

      // Add the 'scrolling' class to the element that is being scrolled
      event.target.classList.add('scrolling');
      
      // Clear the timeout to avoid multiple executions
      clearTimeout(event.target.scrollTimeout);

      event.target.scrollTimeout = setTimeout(() => {
        event.target.classList.remove('scrolling');
      }, 2000); 
    }

    // Attach the scroll event listener to all scrollable elements
    document.querySelectorAll('body, html, *').forEach(el => {
      if (el.scrollHeight > el.clientHeight) {
        el.addEventListener('scroll', handleScroll);
      }
    });

    </script>
  </body>
</html>
